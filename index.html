<!DOCTYPE html>
<html lang="pl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Quiz dla Zakochanych</title>
  <!-- Romantyczne fonty -->
  <link href="https://fonts.googleapis.com/css2?family=Dancing+Script&family=Montserrat:wght@400;700&display=swap" rel="stylesheet">
  <style>
    body {
      margin: 0;
      padding: 0;
      background: linear-gradient(135deg, #ffe6e6, #ffc0cb);
      font-family: 'Montserrat', sans-serif;
    }
    .container {
      max-width: 800px;
      margin: 20px auto;
      padding: 20px;
      background: rgba(255, 255, 255, 0.9);
      border-radius: 12px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
    }
    h1, h2, h3 {
      font-family: 'Dancing Script', cursive;
      text-align: center;
      color: #d6336c;
    }
    p, label, li {
      color: #333;
      line-height: 1.6;
    }
    button {
      background: #d6336c;
      border: none;
      padding: 10px 20px;
      color: #fff;
      cursor: pointer;
      border-radius: 5px;
      font-size: 16px;
      margin-top: 15px;
    }
    button:hover {
      background: #b02a47;
    }
    form {
      display: flex;
      flex-direction: column;
    }
    input[type="text"],
    input[type="number"] {
      padding: 8px;
      margin-top: 5px;
      border: 1px solid #ccc;
      border-radius: 4px;
      font-size: 16px;
    }
    fieldset {
      margin-top: 20px;
      border: 1px solid #d6336c;
      padding: 15px;
      border-radius: 8px;
      background: #fff;
    }
    legend {
      font-weight: bold;
      color: #d6336c;
    }
    .link-box {
      background: #f8d7da;
      padding: 10px;
      border-radius: 5px;
      margin: 10px 0;
      word-break: break-all;
      text-align: center;
      font-weight: bold;
    }
    @media (max-width: 600px) {
      .container {
        margin: 10px;
        padding: 15px;
      }
      button {
        width: 100%;
      }
    }
  </style>
</head>
<body>
  <div class="container" id="app">
    <!-- Treść generowana przez JavaScript -->
  </div>

  <script>
    // Helper: pobieranie parametrów URL
    function getQueryParam(param) {
      const urlParams = new URLSearchParams(window.location.search);
      return urlParams.get(param);
    }

    // Generowanie unikalnego tokena
    function generateToken() {
      return Math.random().toString(36).substr(2, 8);
    }

    // Klucz w localStorage dla danego tokena
    function sessionKey(token) {
      return 'quizSession_' + token;
    }

    /* 
      Dane quizu – 6 kategorii, każda z 10 pytaniami.
      Teksty pytań zawierają placeholdery {p1} oraz {p2},
      które zostaną zastąpione imionami partnerów.
    */
    const quizData = [
      {
        category: "Życie codzienne",
        questions: [
          { id: "codzienne1", text: "Kto jest bardziej zorganizowany? {p1} vs {p2}" },
          { id: "codzienne2", text: "Kto bardziej pamięta drobne szczegóły dnia codziennego? {p1} vs {p2}" },
          { id: "codzienne3", text: "Kto częściej przejmuje inicjatywę w planowaniu dnia? {p1} vs {p2}" },
          { id: "codzienne4", text: "Kto lepiej radzi sobie w sytuacjach kryzysowych? {p1} vs {p2}" },
          { id: "codzienne5", text: "Kto jest bardziej punktualny? {p1} vs {p2}" },
          { id: "codzienne6", text: "Kto bardziej dba o porządek w domu? {p1} vs {p2}" },
          { id: "codzienne7", text: "Kto jest bardziej praktyczny w codziennych sprawach? {p1} vs {p2}" },
          { id: "codzienne8", text: "Kto częściej podejmuje spontaniczne decyzje? {p1} vs {p2}" },
          { id: "codzienne9", text: "Kto bardziej ceni rutynę i stabilność? {p1} vs {p2}" },
          { id: "codzienne10", text: "Kto częściej organizuje wspólne wyjścia? {p1} vs {p2}" }
        ]
      },
      {
        category: "Romantyzm",
        questions: [
          { id: "romantyzm1", text: "Kto jest bardziej romantyczny? {p1} vs {p2}" },
          { id: "romantyzm2", text: "Kto częściej organizuje niespodzianki? {p1} vs {p2}" },
          { id: "romantyzm3", text: "Kto jest bardziej skłonny do okazywania uczuć? {p1} vs {p2}" },
          { id: "romantyzm4", text: "Kto lepiej planuje romantyczne kolacje? {p1} vs {p2}" },
          { id: "romantyzm5", text: "Kto częściej wspomina o wspólnych chwilach? {p1} vs {p2}" },
          { id: "romantyzm6", text: "Kto bardziej dba o intymne gesty? {p1} vs {p2}" },
          { id: "romantyzm7", text: "Kto jest bardziej sentymentalny? {p1} vs {p2}" },
          { id: "romantyzm8", text: "Kto bardziej lubi przytulanie? {p1} vs {p2}" },
          { id: "romantyzm9", text: "Kto częściej marzy o idealnej miłości? {p1} vs {p2}" },
          { id: "romantyzm10", text: "Kto bardziej dba o romantyczny nastrój w domu? {p1} vs {p2}" }
        ]
      },
      {
        category: "Przygody i spontaniczność",
        questions: [
          { id: "przygody1", text: "Kto jest bardziej spontaniczny? {p1} vs {p2}" },
          { id: "przygody2", text: "Kto częściej podejmuje ryzykowne decyzje? {p1} vs {p2}" },
          { id: "przygody3", text: "Kto jest bardziej otwarty na nowe doświadczenia? {p1} vs {p2}" },
          { id: "przygody4", text: "Kto częściej inicjuje niespodziewane wypady? {p1} vs {p2}" },
          { id: "przygody5", text: "Kto jest bardziej żądny przygód? {p1} vs {p2}" },
          { id: "przygody6", text: "Kto częściej planuje wakacje pełne przygód? {p1} vs {p2}" },
          { id: "przygody7", text: "Kto jest bardziej gotowy na spontaniczne podróże? {p1} vs {p2}" },
          { id: "przygody8", text: "Kto częściej rezygnuje z rutyny dla nowych wrażeń? {p1} vs {p2}" },
          { id: "przygody9", text: "Kto bardziej cieszy się z niespodziewanych wydarzeń? {p1} vs {p2}" },
          { id: "przygody10", text: "Kto jest bardziej otwarty na zmiany? {p1} vs {p2}" }
        ]
      },
      {
        category: "Plany na przyszłość",
        questions: [
          { id: "przyszlosc1", text: "Kto jest bardziej zorientowany na przyszłość? {p1} vs {p2}" },
          { id: "przyszlosc2", text: "Kto częściej planuje długoterminowe cele? {p1} vs {p2}" },
          { id: "przyszlosc3", text: "Kto lepiej wizualizuje wspólną przyszłość? {p1} vs {p2}" },
          { id: "przyszlosc4", text: "Kto częściej mówi o planach na przyszłość? {p1} vs {p2}" },
          { id: "przyszlosc5", text: "Kto bardziej marzy o wspólnym życiu? {p1} vs {p2}" },
          { id: "przyszlosc6", text: "Kto częściej podejmuje decyzje z myślą o przyszłości? {p1} vs {p2}" },
          { id: "przyszlosc7", text: "Kto jest bardziej skłonny do inwestowania w przyszłość? {p1} vs {p2}" },
          { id: "przyszlosc8", text: "Kto bardziej dba o bezpieczeństwo finansowe? {p1} vs {p2}" },
          { id: "przyszlosc9", text: "Kto lepiej radzi sobie z planowaniem rodziny? {p1} vs {p2}" },
          { id: "przyszlosc10", text: "Kto bardziej angażuje się w budowanie wspólnego jutra? {p1} vs {p2}" }
        ]
      },
      {
        category: "Intymność",
        questions: [
          { id: "intymnosc1", text: "Kto jest bardziej czuły? {p1} vs {p2}" },
          { id: "intymnosc2", text: "Kto bardziej inicjuje romantyczne gesty? {p1} vs {p2}" },
          { id: "intymnosc3", text: "Kto częściej okazuje swoje uczucia publicznie? {p1} vs {p2}" },
          { id: "intymnosc4", text: "Kto jest bardziej otwarty na fizyczną bliskość? {p1} vs {p2}" },
          { id: "intymnosc5", text: "Kto częściej dba o intymną atmosferę? {p1} vs {p2}" },
          { id: "intymnosc6", text: "Kto jest bardziej zmysłowy? {p1} vs {p2}" },
          { id: "intymnosc7", text: "Kto częściej mówi o swoich potrzebach intymnych? {p1} vs {p2}" },
          { id: "intymnosc8", text: "Kto jest bardziej zaangażowany w budowanie intymności? {p1} vs {p2}" },
          { id: "intymnosc9", text: "Kto częściej inicjuje chwile bliskości? {p1} vs {p2}" },
          { id: "intymnosc10", text: "Kto bardziej dba o komfort emocjonalny partnera? {p1} vs {p2}" }
        ]
      }
    ];

    const appDiv = document.getElementById('app');

    // Zapis sesji w localStorage
    function saveSession(token, sessionData) {
      localStorage.setItem(sessionKey(token), JSON.stringify(sessionData));
    }

    // Odczyt sesji z localStorage
    function loadSession(token) {
      const data = localStorage.getItem(sessionKey(token));
      return data ? JSON.parse(data) : null;
    }

    // Funkcja pomocnicza do zastąpienia placeholderów {p1} i {p2} imionami
    function formatQuestion(text, partner1Name, partner2Name) {
      return text.replace(/{p1}/g, partner1Name).replace(/{p2}/g, partner2Name);
    }

    // Strona tworzenia nowego quizu – wpisz imiona obu partnerów
    function showCreateQuiz() {
      appDiv.innerHTML = `
        <h1>Quiz dla Zakochanych</h1>
        <p>Wprowadź imiona obojga partnerów, aby utworzyć quiz.</p>
        <form id="createQuizForm">
          <label for="partner1Name">Imię Partnera 1:</label>
          <input type="text" id="partner1Name" name="partner1Name" required>
          <label for="partner2Name">Imię Partnera 2:</label>
          <input type="text" id="partner2Name" name="partner2Name" required>
          <button type="submit">Utwórz Quiz</button>
        </form>
      `;
      document.getElementById('createQuizForm').addEventListener('submit', function(e) {
        e.preventDefault();
        const partner1Name = e.target.partner1Name.value.trim();
        const partner2Name = e.target.partner2Name.value.trim();
        if (!partner1Name || !partner2Name) {
          alert("Proszę wpisać imiona obu partnerów.");
          return;
        }
        const token = generateToken();
        const sessionData = {
          token: token,
          partner1Name: partner1Name,
          partner2Name: partner2Name,
          answers: {}
        };
        saveSession(token, sessionData);
        // Przekierowanie – wyświetl stronę z linkiem dla Partnera 2 i przyciskiem kopiowania
        showLinkPage(sessionData);
      });
    }

    // Strona wyświetlająca link dla partnera 2 z przyciskiem do kopiowania
    function showLinkPage(sessionData) {
      const baseUrl = window.location.origin + window.location.pathname;
      const partner2Link = `${baseUrl}?token=${sessionData.token}&partner=2`;
      appDiv.innerHTML = `
        <h2>Quiz Utworzony!</h2>
        <p>Wyślij ten link swojemu partnerowi, aby mógł wypełnić quiz:</p>
        <div class="link-box" id="partner2Link">${partner2Link}</div>
        <button id="copyBtn">Kopiuj link</button>
        <hr>
        <p>Jeśli chcesz, możesz już wypełnić quiz jako <strong>${sessionData.partner1Name}</strong>:</p>
        <a href="${baseUrl}?token=${sessionData.token}&partner=1"><button>Przejdź do quizu</button></a>
        <button id="newQuizBtn" style="background: #6c757d;">Utwórz nowy quiz</button>
      `;
      document.getElementById('copyBtn').addEventListener('click', function() {
        const linkText = document.getElementById('partner2Link').innerText;
        navigator.clipboard.writeText(linkText).then(function() {
          alert("Link został skopiowany do schowka!");
        }, function(err) {
          alert("Wystąpił błąd podczas kopiowania linku.");
        });
      });
      document.getElementById('newQuizBtn').addEventListener('click', () => {
        window.location.href = window.location.origin + window.location.pathname;
      });
    }

    // Formularz quizu – partner odpowiada na 50 pytań (porównawczych)
    function showQuizForm(sessionData, partnerNum) {
      const partnerName = partnerNum === "1" ? sessionData.partner1Name : sessionData.partner2Name;
      let formHtml = `<h2>Quiz dla ${partnerName}</h2>
        <p>Odpowiedz na poniższe pytania, wybierając wartość w skali 1-10.<br>
        <small>(1 – bardziej cecha <em>${sessionData.partner1Name}</em>, 10 – bardziej cecha <em>${sessionData.partner2Name}</em>, 5 – równo)</small></p>
        <form id="quizForm">`;
      quizData.forEach(category => {
        formHtml += `<fieldset>
          <legend>${category.category}</legend>`;
        category.questions.forEach(q => {
          const formattedText = formatQuestion(q.text, sessionData.partner1Name, sessionData.partner2Name);
          formHtml += `
            <label for="${q.id}">${formattedText}</label>
            <input type="number" id="${q.id}" name="${q.id}" min="1" max="10" required>
          `;
        });
        formHtml += `</fieldset>`;
      });
      formHtml += `<button type="submit">Zapisz odpowiedzi</button></form>`;
      appDiv.innerHTML = formHtml;

      document.getElementById('quizForm').addEventListener('submit', function(e) {
        e.preventDefault();
        const formData = new FormData(e.target);
        let answers = {};
        quizData.forEach(category => {
          category.questions.forEach(q => {
            answers[q.id] = formData.get(q.id);
          });
        });
        sessionData.answers["partner" + partnerNum] = answers;
        saveSession(sessionData.token, sessionData);
        if (sessionData.answers.partner1 && sessionData.answers.partner2) {
          showResults(sessionData);
        } else {
          appDiv.innerHTML = `<p>Dziękujemy, ${partnerName}. Twoje odpowiedzi zostały zapisane. Czekamy na odpowiedzi drugiego partnera.</p>
          <button id="backBtn">Powrót</button>`;
          document.getElementById('backBtn').addEventListener('click', () => location.reload());
        }
      });
    }

    // Wyliczanie i wyświetlanie wyników – ogólna zgodność oraz wyniki per kategoria
    function showResults(sessionData) {
      const answers1 = sessionData.answers.partner1;
      const answers2 = sessionData.answers.partner2;
      let totalDifference = 0;
      let totalQuestions = 0;
      let categoryResultsHtml = "";
      quizData.forEach(category => {
        let catDifference = 0;
        const catQuestions = category.questions.length;
        category.questions.forEach(q => {
          const a1 = parseInt(answers1[q.id], 10);
          const a2 = parseInt(answers2[q.id], 10);
          catDifference += Math.abs(a1 - a2);
        });
        totalDifference += catDifference;
        totalQuestions += catQuestions;
        const maxDiffCat = catQuestions * 9;
        const similarityCat = 100 - ((catDifference / maxDiffCat) * 100);
        categoryResultsHtml += `<li><strong>${category.category}:</strong> Zgodność: ${similarityCat.toFixed(2)}%</li>`;
      });
      const overallMax = totalQuestions * 9;
      const overallSimilarity = 100 - ((totalDifference / overallMax) * 100);

      appDiv.innerHTML = `
        <h2>Wyniki Quizu</h2>
        <p><strong>${sessionData.partner1Name}</strong> vs <strong>${sessionData.partner2Name}</strong></p>
        <p>Ogólna zgodność: <strong>${overallSimilarity.toFixed(2)}%</strong></p>
        <h3>Szczegółowe wyniki według kategorii:</h3>
        <ul>${categoryResultsHtml}</ul>
        <button id="resetBtn">Resetuj Quiz</button>
      `;
      document.getElementById('resetBtn').addEventListener('click', function() {
        localStorage.removeItem(sessionKey(sessionData.token));
        window.location.href = window.location.origin + window.location.pathname;
      });
    }

    // Główna logika – sprawdzamy, czy w URL są parametry token (sesji) oraz partner
    (function() {
      const token = getQueryParam('token');
      const partner = getQueryParam('partner');
      if (token) {
        const sessionData = loadSession(token);
        if (!sessionData) {
          appDiv.innerHTML = `<p>Błąd: Nie znaleziono sesji quizu. Upewnij się, że link jest poprawny.</p>`;
          return;
        }
        if (!partner) {
          appDiv.innerHTML = `<p>Błąd: Brak informacji o partnerze. Użyj linku z parametrem 'partner'.</p>`;
          return;
        }
        showQuizForm(sessionData, partner);
      } else {
        showCreateQuiz();
      }
    })();
  </script>
</body>
</html>
